# Taromine - 多端统一开发框架项目文档

## 📋 项目概述

**项目名称**: Taromine  
**版本**: 1.0.0  
**描述**: 基于 Taro 多端统一开发框架的 React TypeScript 入门学习示例，模仿 TodoMVC，支持微信小程序、H5 等多个平台。

### 🎯 项目特色

- **多端适配**: 一套代码，多端运行，支持微信小程序、H5、支付宝小程序、字节跳动小程序、QQ 小程序、京东小程序等
- **现代化技术栈**: 使用 React 18 + TypeScript + Redux Toolkit 的现代化开发体验
- **完整的组件生态**: 集成 Taroify 组件库，提供丰富的 UI 组件
- **样式解决方案**: 使用 TailwindCSS + Sass，支持响应式设计
- **状态管理**: 基于 Redux Toolkit 的现代化状态管理
- **GraphQL 支持**: 集成 GraphQL 代码生成和 URQL 客户端
- **开发体验优化**: 支持热重载、TypeScript 类型检查、ESLint 代码规范

### 🛠 核心技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **Taro** | 4.1.6 | 多端统一开发框架 |
| **React** | ^18.1 | 前端 UI 框架 |
| **TypeScript** | ^5.9.2 | 类型安全的 JavaScript 超集 |
| **Redux Toolkit** | ^2.9.0 | 现代化状态管理 |
| **Taroify** | ^0.9.0 | 基于 Taro 的 UI 组件库 |
| **TailwindCSS** | ^4.1.13 | 原子化 CSS 框架 |
| **GraphQL** | ^16.11.0 | 数据查询语言 |
| **URQL** | ^5.0.1 | GraphQL 客户端 |

## 🏗 项目架构

### 目录结构

```
taromine-taroify/
├── src/                          # 源代码目录
│   ├── app.config.ts            # 应用配置文件
│   ├── app.tsx                  # 应用入口组件
│   ├── app.scss                 # 全局样式
│   ├── components/              # 通用组件
│   │   ├── card.tsx            # 卡片组件
│   │   ├── header.tsx          # 头部组件
│   │   ├── main.tsx            # 主体组件
│   │   ├── footer.tsx          # 底部组件
│   │   ├── item.tsx            # 列表项组件
│   │   ├── todoTextInput.tsx   # Todo 输入组件
│   │   └── ...                 # 其他组件
│   ├── pages/                   # 页面目录
│   │   ├── index/              # 首页
│   │   │   ├── index.tsx       # 首页组件
│   │   │   └── index.config.ts # 首页配置
│   │   └── examples/           # 示例页面
│   │       ├── counters.tsx    # 计数器示例
│   │       ├── todoMVC.tsx     # TodoMVC 示例
│   │       └── form/           # 表单示例
│   ├── store/                   # 状态管理
│   │   ├── index.ts            # Store 配置
│   │   ├── counterSlice.ts     # 计数器状态切片
│   │   └── todosSlice.ts       # Todo 状态切片
│   ├── gql/                     # GraphQL 相关
│   │   ├── index.ts            # GraphQL 导出
│   │   ├── gql.ts              # 生成的 GraphQL 代码
│   │   └── graphql.ts          # GraphQL 类型定义
│   ├── schema/                  # 数据模式
│   │   └── home.ts             # 首页数据模式
│   └── constants/               # 常量定义
│       └── todo-filter.ts      # Todo 过滤器常量
├── config/                      # 构建配置
│   ├── index.ts                # 主配置文件
│   ├── dev.ts                  # 开发环境配置
│   └── prod.ts                 # 生产环境配置
├── dist/                        # 构建输出目录
├── types/                       # TypeScript 类型定义
├── package.json                 # 项目依赖配置
├── tsconfig.json               # TypeScript 配置
├── babel.config.js             # Babel 配置
├── postcss.config.mjs          # PostCSS 配置
└── project.config.json         # 小程序项目配置
```

### 模块划分

#### 1. 核心应用模块 (`src/app.*`)
- **app.tsx**: 应用根组件，配置 Redux Provider 和 GraphQL Client
- **app.config.ts**: 应用全局配置，定义页面路由和分包策略
- **app.scss**: 全局样式导入，包含 Taroify 组件库样式

#### 2. 页面模块 (`src/pages/`)
- **index**: 首页模块，展示项目功能和导航
- **examples**: 示例页面集合
  - `counters.tsx`: Redux 计数器示例
  - `todoMVC.tsx`: TodoMVC 应用示例
  - `form/`: 表单处理示例

#### 3. 组件模块 (`src/components/`)
- **通用组件**: 可复用的 UI 组件
- **业务组件**: 特定功能的组件（如 TodoTextInput）
- **布局组件**: 页面布局相关组件（Header、Main、Footer）

#### 4. 状态管理模块 (`src/store/`)
- **Redux Toolkit 配置**: 现代化的 Redux 状态管理
- **Slice 模式**: 将状态和 reducer 组织在一起
- **类型安全**: 完整的 TypeScript 类型支持

#### 5. GraphQL 模块 (`src/gql/`)
- **代码生成**: 基于 schema 自动生成 TypeScript 类型
- **客户端配置**: URQL GraphQL 客户端集成
- **类型安全**: 完整的 GraphQL 操作类型定义

### 技术架构特点

#### 多端适配策略
- **统一代码库**: 一套代码适配多个平台
- **平台差异处理**: 通过 Taro 的条件编译处理平台特性
- **组件抽象**: 使用 Taro 组件抽象层屏蔽平台差异

#### 状态管理架构
- **Redux Toolkit**: 现代化的 Redux 开发体验
- **Slice 模式**: 将相关的状态和 reducer 组织在一起
- **类型安全**: 完整的 TypeScript 类型推导

#### 样式解决方案
- **TailwindCSS**: 原子化 CSS 框架，支持响应式设计
- **weapp-tailwindcss**: 解决小程序平台的 TailwindCSS 兼容性
- **Sass**: 支持传统的 CSS 预处理器
- **组件库样式**: Taroify 提供的现成 UI 组件样式

## 🚀 开发环境配置

### 环境要求

- **Node.js**: >= 16.0.0 (推荐使用 LTS 版本)
- **包管理器**: pnpm (推荐) 或 npm/yarn
- **Taro CLI**: 全局安装 Taro 命令行工具

### 安装步骤

#### 1. 克隆项目

```bash
git clone <repository-url>
cd taromine-taroify
```

#### 2. 安装依赖

```bash
# 使用 pnpm (推荐)
pnpm install

# 或使用 npm
npm install

# 或使用 yarn
yarn install
```

#### 3. 全局安装 Taro CLI

```bash
# 使用 npm
npm install -g @tarojs/cli

# 或使用 pnpm
pnpm add -g @tarojs/cli
```

#### 4. 开发环境启动

```bash
# H5 开发模式
pnpm dev:h5

# 微信小程序开发模式
pnpm dev:weapp

# 支付宝小程序开发模式
pnpm dev:alipay

# 字节跳动小程序开发模式
pnpm dev:tt

# QQ 小程序开发模式
pnpm dev:qq
```

#### 5. 生产环境构建

```bash
# H5 生产构建
pnpm build:h5

# 微信小程序生产构建
pnpm build:weapp

# 支付宝小程序生产构建
pnpm build:alipay

# 其他平台构建
pnpm build:tt
pnpm build:qq
pnpm build:jd
```

### 开发工具配置

#### 微信开发者工具
1. 下载并安装微信开发者工具
2. 导入项目目录中的 `dist` 文件夹
3. 项目配置文件：`project.config.json`

#### VS Code 推荐插件
- **Taro**: Taro 开发支持
- **ES7+ React/Redux/React-Native snippets**: React 代码片段
- **Tailwind CSS IntelliSense**: TailwindCSS 智能提示
- **TypeScript Importer**: TypeScript 自动导入
- **Prettier**: 代码格式化
- **ESLint**: 代码规范检查

### 环境变量配置

项目支持多环境配置，通过以下文件管理：

- `config/dev.ts`: 开发环境配置
- `config/prod.ts`: 生产环境配置
- `config/index.ts`: 通用配置

#### GraphQL 服务配置

开发环境默认代理配置：
```typescript
// config/dev.ts
h5: {
  devServer: {
    proxy: {
      '/graphql': {
        target: 'http://localhost:3000',
        changeOrigin: true,
        secure: false,
      },
    },
  },
}
```

## 🔧 核心技术栈详解

### Taro 框架配置

#### 基础配置 (`config/index.ts`)

```typescript
export default defineConfig<'webpack5'>(async (merge, { command, mode }) => {
  const baseConfig: UserConfigExport<'webpack5'> = {
    projectName: 'myApp',
    framework: 'react',
    compiler: { type: 'webpack5', prebundle: { enable: true } },
    designWidth: 750,
    deviceRatio: {
      640: 2.34 / 2,
      750: 1,
      375: 2,
      828: 1.81 / 2,
    },
    // 多端配置
    mini: { /* 小程序配置 */ },
    h5: { /* H5 配置 */ },
    rn: { /* React Native 配置 */ }
  }
})
```

#### 多端适配配置

**小程序配置**：
- 支持微信、支付宝、字节跳动、QQ、京东小程序
- 自动处理 rpx 单位转换
- TailwindCSS 小程序适配

**H5 配置**：
- Webpack 5 构建优化
- 支持现代浏览器特性
- 开发服务器代理配置

### Redux Toolkit 状态管理

#### Store 配置

```typescript
// src/store/index.ts
import { configureStore } from '@reduxjs/toolkit'
import counterReducer from './counterSlice'
import todosReducer from './todosSlice'

export const store = configureStore({
  reducer: { 
    counter: counterReducer, 
    todos: todosReducer 
  },
})

export type RootState = ReturnType<typeof store.getState>
export type AppDispatch = typeof store.dispatch
```

#### Slice 模式示例

```typescript
// src/store/counterSlice.ts
export const counterSlice = createSlice({
  name: 'counter',
  initialState: { value: 0 },
  reducers: {
    increment: (state) => {
      state.value += 1
    },
    decrement: (state) => {
      state.value -= 1
    },
  },
})
```

#### 类型安全的 Hooks

```typescript
export const useAppDispatch = useDispatch.withTypes<AppDispatch>()
export const useAppSelector = useSelector.withTypes<RootState>()
```

### Taroify 组件库

#### 组件导入配置

```javascript
// babel.config.js
plugins: [
  [
    'import',
    {
      libraryName: '@taroify/core',
      libraryDirectory: '',
      style: false, // 避免与 weapp-tailwindcss 冲突
    },
    '@taroify/core',
  ],
]
```

#### 样式导入

```typescript
// src/app.tsx
import '@taroify/icons/index.scss'
import '@taroify/core/index.scss'
```

#### 常用组件示例

```tsx
import { Button, ConfigProvider, Flex } from '@taroify/core'

function App() {
  return (
    <ConfigProvider>
      <Flex gutter={16}>
        <Flex.Item span={8}>
          <Button color="primary">按钮</Button>
        </Flex.Item>
      </Flex>
    </ConfigProvider>
  )
}
```

### TailwindCSS 配置

#### PostCSS 配置

```javascript
// postcss.config.mjs
export default {
  plugins: {
    '@tailwindcss/postcss': {},
  },
}
```

#### 小程序适配配置

```javascript
// config/index.ts
import { UnifiedWebpackPluginV5 } from 'weapp-tailwindcss/webpack'

webpackChain(chain) {
  chain.merge({
    plugin: {
      install: {
        plugin: UnifiedWebpackPluginV5,
        args: [{
          disabled: WeappTailwindcssDisabled,
          rem2rpx: true,
          injectAdditionalCssVarScope: true,
        }],
      },
    },
  })
}
```

### GraphQL 集成

#### 代码生成配置

```typescript
// codegen.ts
const config: CodegenConfig = {
  schema: "http://localhost:3000/graphql",
  documents: ["src/schema/*.graphql", "src/schema/*.ts"],
  generates: {
    "./src/gql/": {
      preset: "client",
      config: {
        useTypeImports: true,
      },
    },
  },
}
```

#### URQL 客户端配置

```typescript
// src/app.tsx
import { Client, Provider as UrqlProvider, cacheExchange, fetchExchange } from 'urql'

const client = new Client({
  url: '/graphql',
  exchanges: [cacheExchange, fetchExchange],
})

function App({ children }) {
  return (
    <UrqlProvider value={client}>
      {children}
    </UrqlProvider>
  )
}
```

### TypeScript 配置

#### 编译选项

```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "es2017",
    "module": "commonjs",
    "jsx": "react-jsx",
    "strict": true,
    "baseUrl": ".",
    "paths": {
      "~/*": ["./src/*"]
    }
  }
}
```

#### 路径别名配置

```typescript
// config/index.ts
import TsconfigPathsPlugin from 'tsconfig-paths-webpack-plugin'

webpackChain(chain) {
  chain.resolve.plugin('tsconfig-paths').use(TsconfigPathsPlugin)
}
```

## 📦 组件架构与页面结构

### 页面组件详解

#### 1. 首页 (`src/pages/index/index.tsx`)

首页作为应用的入口页面，展示了项目的主要功能和导航：

```tsx
function Index() {
  return (
    <ConfigProvider>
      {/* GraphQL 示例组件 */}
      <CommentExample />
      
      {/* 树形选择组件 */}
      <RadioTreeSelect />
      
      {/* 卡片组件展示 */}
      <View className='flex flex-cols-2'>
        <Card></Card>
        <Card></Card>
      </View>
      
      {/* 导航按钮 */}
      <Flex gutter={16} className='p-4'>
        <Flex.Item span={8}>
          <Button onClick={() => Taro.navigateTo({ url: '/pages/examples/form/form' })}>
            Taroify Form
          </Button>
        </Flex.Item>
        {/* 更多导航按钮... */}
      </Flex>
    </ConfigProvider>
  )
}
```

**功能特点**：
- 集成多种组件展示
- 提供应用内导航
- 展示 TailwindCSS 样式效果
- GraphQL 数据获取示例

#### 2. 计数器页面 (`src/pages/examples/counters.tsx`)

Redux 状态管理的简单示例：

```tsx
export default function Counter() {
  const count = useAppSelector((state) => state.counter.value)
  const dispatch = useAppDispatch()

  return (
    <View className='mt-10 mx-auto'>
      <View className='flex flex-row justify-center gap-4'>
        <Button onClick={() => dispatch(increment())}>
          Increment
        </Button>
        {count}
        <Button onClick={() => dispatch(decrement())}>
          Decrement
        </Button>
      </View>
    </View>
  )
}
```

**技术要点**：
- Redux Toolkit 状态管理
- 类型安全的 Hooks 使用
- Taroify 组件集成
- TailwindCSS 响应式布局

#### 3. TodoMVC 页面 (`src/pages/examples/todoMVC.tsx`)

完整的 TodoMVC 应用实现：

```tsx
export default function Counter() {
  return (
    <View className='bg-neutral-100 shadow-black/20 shadow-sm'>
      <Header />
      <Main />
    </View>
  )
}
```

**组件结构**：
- **Header**: 标题和新增 Todo 输入
- **Main**: Todo 列表和过滤功能
- **Footer**: 统计信息和批量操作

### 核心组件详解

#### 1. Header 组件 (`src/components/header.tsx`)

```tsx
const Header = () => {
  const dispatch = useAppDispatch()

  const onSaveHandler = (text: string) => {
    if (text.length !== 0) {
      dispatch(addTodo(text))
    }
  }

  return (
    <View>
      <View className='py-2 text-center'>
        <Text className='font-bold text-2xl'>todos</Text>
      </View>
      <TodoTextInput onSave={onSaveHandler} placeholder='What needs to be done?' />
    </View>
  )
}
```

#### 2. Main 组件 (`src/components/main.tsx`)

```tsx
export default function Main() {
  const todos = useAppSelector((state) => state.todos)
  const [visibilityFilter, setVisibilityFilter] = useState(VisibilityFilter.SHOW_ALL)

  const visibleTodos = useMemo(() => {
    switch (visibilityFilter) {
      case VisibilityFilter.SHOW_ALL:
        return todos
      case VisibilityFilter.SHOW_ACTIVE:
        return todos.filter((todo) => !todo.completed)
      case VisibilityFilter.SHOW_COMPLETED:
        return todos.filter((todo) => todo.completed)
      default:
        return todos
    }
  }, [todos, visibilityFilter])

  return (
    <main>
      <View className='p-1'>
        {visibleTodos.map((todo) => (
          <Item key={todo.id} todo={todo} />
        ))}
      </View>
      <Footer /* props */ />
    </main>
  )
}
```

#### 3. TodoTextInput 组件 (`src/components/todoTextInput.tsx`)

可复用的文本输入组件，支持：
- 受控组件模式
- 键盘事件处理
- 自动聚焦功能
- 样式定制

### 状态管理架构

#### Todo 状态切片

```typescript
export interface TodoState {
  id: string
  todotext: string
  completed: boolean
}

export const TodosSlice = createSlice({
  name: 'todos',
  initialState: [] as TodoState[],
  reducers: {
    addTodo: (state, action: PayloadAction<string>) => {
      state.push({ 
        id: action.payload, 
        todotext: action.payload, 
        completed: false 
      })
    },
    deleteTodo: (state, action: PayloadAction<string>) => {
      return state.filter((todo) => todo.id !== action.payload)
    },
    toggleTodo: (state, action: PayloadAction<string>) => {
      const todo = state.find((todo) => todo.id === action.payload)
      if (todo) {
        todo.completed = !todo.completed
      }
    },
    // 更多 reducers...
  },
})
```

### 样式架构

#### TailwindCSS 使用模式

```tsx
// 响应式设计
<View className='flex flex-col md:flex-row gap-4'>

// 条件样式
<Text className={`text-base ${completed ? 'line-through text-gray-500' : 'text-black'}`}>

// 小程序适配的 rpx 单位
<View className='text-[54.32rpx] bg-[#534312]'>
```

#### 组件样式组织

- **全局样式**: `src/app.scss`
- **组件样式**: 各组件目录下的 `.sass` 文件
- **Taroify 样式**: 自动导入的组件库样式
- **TailwindCSS**: 原子化工具类

### 路由配置

#### 应用路由配置 (`src/app.config.ts`)

```typescript
export default defineAppConfig({
  pages: ['pages/index/index'],
  subPackages: [
    {
      root: 'pages/examples',
      pages: ['counters', 'todoMVC', 'form/form'],
    },
  ],
  window: {
    backgroundTextStyle: 'light',
    navigationBarBackgroundColor: '#fff',
    navigationBarTitleText: 'WeChat',
    navigationBarTextStyle: 'black',
  },
})
```

**路由特点**：
- 主包和分包策略
- 页面级配置支持
- 多端统一的导航配置

## 🚢 多端构建与部署

### 支持的平台

项目支持以下平台的构建和部署：

| 平台 | 命令 | 输出目录 | 特殊配置 |
|------|------|----------|----------|
| **微信小程序** | `pnpm build:weapp` | `dist/` | `project.config.json` |
| **H5** | `pnpm build:h5` | `dist/` | Webpack 构建 |
| **支付宝小程序** | `pnpm build:alipay` | `dist/` | 支付宝开发者工具 |
| **字节跳动小程序** | `pnpm build:tt` | `dist/` | `project.tt.json` |
| **QQ 小程序** | `pnpm build:qq` | `dist/` | QQ 开发者工具 |
| **京东小程序** | `pnpm build:jd` | `dist/` | 京东开发者工具 |
| **快应用** | `pnpm build:quickapp` | `dist/` | 快应用开发工具 |

### 构建流程详解

#### 1. 开发环境构建

```bash
# 启动开发服务器（支持热重载）
pnpm dev:h5

# 微信小程序开发模式
pnpm dev:weapp --watch
```

**开发模式特性**：
- 热重载 (Hot Reload)
- 源码映射 (Source Map)
- 开发者工具集成
- 实时错误提示
- GraphQL 代理配置

#### 2. 生产环境构建

```bash
# H5 生产构建
pnpm build:h5

# 微信小程序生产构建
pnpm build:weapp
```

**生产构建优化**：
- 代码压缩和混淆
- Tree Shaking 优化
- 依赖预编译 (Prebundle)
- 静态资源优化
- 分包策略实施

#### 3. 构建配置差异

**小程序构建配置**：
```typescript
mini: {
  webpackChain(chain) {
    // TailwindCSS 小程序适配
    chain.merge({
      plugin: {
        install: {
          plugin: UnifiedWebpackPluginV5,
          args: [{
            disabled: WeappTailwindcssDisabled,
            rem2rpx: true,
          }],
        },
      },
    })
  },
}
```

**H5 构建配置**：
```typescript
h5: {
  esnextModules: ['@taroify'],
  publicPath: '/',
  output: {
    filename: 'js/[name].[fullhash:8].js',
    chunkFilename: 'js/[name].[chunkhash:8].js',
  },
}
```

### 部署指南

#### 1. 微信小程序部署

**步骤**：
1. 执行构建命令：`pnpm build:weapp`
2. 打开微信开发者工具
3. 导入 `dist` 目录
4. 配置 `project.config.json`
5. 预览和上传代码

**配置文件**：
```json
{
  "miniprogramRoot": "dist/",
  "projectname": "taromine",
  "description": "Taro TodoMVC 示例项目",
  "appid": "your-app-id",
  "setting": {
    "urlCheck": false,
    "es6": false,
    "enhance": true
  }
}
```

#### 2. H5 部署

**静态部署**：
```bash
# 构建生产版本
pnpm build:h5

# 部署到静态服务器
cp -r dist/* /var/www/html/
```

**Nginx 配置示例**：
```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /var/www/html;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # GraphQL 代理
    location /graphql {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
    }
}
```

#### 3. 支付宝小程序部署

**步骤**：
1. 构建：`pnpm build:alipay`
2. 使用支付宝开发者工具导入
3. 配置应用信息
4. 提交审核

#### 4. 其他平台部署

**字节跳动小程序**：
- 使用字节跳动开发者工具
- 配置 `project.tt.json`
- 遵循字节跳动小程序规范

**QQ 小程序**：
- 使用 QQ 开发者工具
- 适配 QQ 小程序特有 API
- 配置相应的项目文件

### 环境变量管理

#### 多环境配置

```typescript
// config/dev.ts - 开发环境
export default {
  defineConstants: {
    API_URL: '"http://localhost:3000"',
    ENV: '"development"'
  }
}

// config/prod.ts - 生产环境  
export default {
  defineConstants: {
    API_URL: '"https://api.yoursite.com"',
    ENV: '"production"'
  }
}
```

#### 使用环境变量

```typescript
// 在代码中使用
const apiUrl = process.env.API_URL
const isDev = process.env.ENV === 'development'
```

### CI/CD 集成

#### GitHub Actions 示例

```yaml
name: Build and Deploy

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '18'
        
    - name: Install pnpm
      run: npm install -g pnpm
      
    - name: Install dependencies
      run: pnpm install
      
    - name: Build H5
      run: pnpm build:h5
      
    - name: Build WeApp
      run: pnpm build:weapp
      
    - name: Deploy
      run: |
        # 部署脚本
        echo "Deploy to production"
```

### 性能优化

#### 构建优化

- **依赖预编译**: 启用 Webpack 5 的 prebundle 功能
- **代码分割**: 合理的分包策略
- **Tree Shaking**: 移除未使用的代码
- **压缩优化**: 生产环境代码压缩

#### 运行时优化

- **组件懒加载**: 按需加载页面组件
- **图片优化**: 使用适当的图片格式和尺寸
- **缓存策略**: 合理的缓存配置
- **包体积控制**: 分包和主包大小控制

## 📚 开发最佳实践

### 代码规范

#### 1. TypeScript 规范

```typescript
// ✅ 推荐：明确的类型定义
interface UserInfo {
  id: string
  name: string
  avatar?: string
}

// ✅ 推荐：使用严格模式
const getUserInfo = (id: string): Promise<UserInfo> => {
  return api.fetchUser(id)
}

// ❌ 避免：使用 any 类型
const userData: any = response.data
```

#### 2. React 组件规范

```tsx
// ✅ 推荐：函数组件 + Hooks
interface Props {
  title: string
  onSubmit: (value: string) => void
}

const TodoInput: React.FC<Props> = ({ title, onSubmit }) => {
  const [value, setValue] = useState('')
  
  const handleSubmit = useCallback(() => {
    if (value.trim()) {
      onSubmit(value)
      setValue('')
    }
  }, [value, onSubmit])
  
  return (
    <View className="todo-input">
      <Input 
        value={value}
        onChange={setValue}
        placeholder={title}
      />
      <Button onClick={handleSubmit}>提交</Button>
    </View>
  )
}
```

#### 3. Redux 状态管理规范

```typescript
// ✅ 推荐：使用 Redux Toolkit
export const todosSlice = createSlice({
  name: 'todos',
  initialState,
  reducers: {
    // 使用 Immer 进行不可变更新
    addTodo: (state, action: PayloadAction<string>) => {
      state.push({
        id: nanoid(),
        text: action.payload,
        completed: false
      })
    }
  }
})

// ✅ 推荐：类型安全的选择器
export const selectActiveTodos = (state: RootState) => 
  state.todos.filter(todo => !todo.completed)
```

### 样式最佳实践

#### 1. TailwindCSS 使用规范

```tsx
// ✅ 推荐：语义化的样式组合
const Card = ({ children }: Props) => (
  <View className="bg-white rounded-lg shadow-md p-4 mb-4">
    {children}
  </View>
)

// ✅ 推荐：响应式设计
<View className="flex flex-col md:flex-row gap-4">

// ✅ 推荐：条件样式
<Text className={clsx(
  'text-base transition-colors',
  completed && 'line-through text-gray-500',
  !completed && 'text-gray-900'
)}>
```

#### 2. 小程序样式适配

```scss
// ✅ 推荐：使用 rpx 单位进行小程序适配
.container {
  padding: 32rpx;
  font-size: 28rpx;
}

// ✅ 推荐：避免使用小程序不支持的 CSS 属性
.card {
  // ❌ 小程序不支持 box-shadow
  // box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  
  // ✅ 使用 border 替代
  border: 1px solid #e5e5e5;
}
```

### 性能优化建议

#### 1. 组件优化

```tsx
// ✅ 推荐：使用 React.memo 优化重渲染
const TodoItem = React.memo<Props>(({ todo, onToggle, onDelete }) => {
  return (
    <View className="todo-item">
      <Text>{todo.text}</Text>
      <Button onClick={() => onToggle(todo.id)}>切换</Button>
      <Button onClick={() => onDelete(todo.id)}>删除</Button>
    </View>
  )
})

// ✅ 推荐：使用 useCallback 优化事件处理
const TodoList = () => {
  const todos = useAppSelector(selectTodos)
  const dispatch = useAppDispatch()
  
  const handleToggle = useCallback((id: string) => {
    dispatch(toggleTodo(id))
  }, [dispatch])
  
  const handleDelete = useCallback((id: string) => {
    dispatch(deleteTodo(id))
  }, [dispatch])
  
  return (
    <View>
      {todos.map(todo => (
        <TodoItem
          key={todo.id}
          todo={todo}
          onToggle={handleToggle}
          onDelete={handleDelete}
        />
      ))}
    </View>
  )
}
```

#### 2. 图片和资源优化

```tsx
// ✅ 推荐：使用适当的图片格式和尺寸
<Image 
  src="avatar.webp"
  className="w-20 h-20 rounded-full"
  mode="aspectFill"
  lazyLoad
/>

// ✅ 推荐：预加载关键资源
useEffect(() => {
  Taro.preloadPage({
    url: '/pages/detail/index'
  })
}, [])
```

### 错误处理和调试

#### 1. 错误边界

```tsx
// ✅ 推荐：使用错误边界处理组件错误
class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props)
    this.state = { hasError: false }
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true }
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('组件错误:', error, errorInfo)
    // 可以将错误信息发送到错误监控服务
  }

  render() {
    if (this.state.hasError) {
      return <View className="error-fallback">出现了一些问题</View>
    }

    return this.props.children
  }
}
```

#### 2. 调试技巧

```typescript
// ✅ 推荐：使用 Redux DevTools
export const store = configureStore({
  reducer: rootReducer,
  devTools: process.env.NODE_ENV !== 'production'
})

// ✅ 推荐：添加调试信息
const TodoList = () => {
  const todos = useAppSelector(selectTodos)
  
  useEffect(() => {
    if (process.env.NODE_ENV === 'development') {
      console.log('当前 todos:', todos)
    }
  }, [todos])
  
  return <View>{/* 组件内容 */}</View>
}
```

### 多端兼容性

#### 1. 平台差异处理

```tsx
import Taro from '@tarojs/taro'

const ShareButton = () => {
  const handleShare = () => {
    if (process.env.TARO_ENV === 'weapp') {
      // 微信小程序分享
      Taro.showShareMenu()
    } else if (process.env.TARO_ENV === 'h5') {
      // H5 分享
      navigator.share?.({
        title: '分享标题',
        url: window.location.href
      })
    }
  }
  
  return <Button onClick={handleShare}>分享</Button>
}
```

#### 2. API 兼容性

```typescript
// ✅ 推荐：使用 Taro 统一 API
const getUserInfo = async () => {
  try {
    const userInfo = await Taro.getUserInfo()
    return userInfo
  } catch (error) {
    console.error('获取用户信息失败:', error)
    return null
  }
}

// ✅ 推荐：检查 API 可用性
const showToast = (message: string) => {
  if (Taro.showToast) {
    Taro.showToast({
      title: message,
      icon: 'none'
    })
  } else {
    // H5 降级处理
    alert(message)
  }
}
```

### 团队协作

#### 1. Git 工作流

```bash
# ✅ 推荐：使用语义化提交信息
git commit -m "feat: 添加用户登录功能"
git commit -m "fix: 修复 Todo 删除按钮样式问题"
git commit -m "docs: 更新 README 文档"

# ✅ 推荐：功能分支开发
git checkout -b feature/user-profile
git checkout -b bugfix/todo-input-validation
```

#### 2. 代码审查清单

- [ ] 代码是否遵循项目规范？
- [ ] 是否有适当的类型定义？
- [ ] 是否处理了错误情况？
- [ ] 是否考虑了多端兼容性？
- [ ] 是否有必要的测试？
- [ ] 性能是否符合要求？
- [ ] UI 是否符合设计规范？

## ⚠️ 常见问题与解决方案

### 构建问题

#### 1. TailwindCSS 样式不生效

**问题**: 小程序中 TailwindCSS 样式无法正常显示

**解决方案**:
```bash
# 确保正确安装 weapp-tailwindcss
pnpm add weapp-tailwindcss

# 检查 postcss.config.mjs 配置
# 确保 postinstall 脚本执行
pnpm postinstall
```

#### 2. GraphQL 代码生成失败

**问题**: `pnpm codegen` 命令执行失败

**解决方案**:
```bash
# 检查 GraphQL 服务是否运行
curl http://localhost:3000/graphql

# 更新 codegen 配置
# 确保 schema 地址正确
```

#### 3. 小程序包体积过大

**问题**: 小程序主包或分包体积超出限制

**解决方案**:
```typescript
// 优化分包策略
export default defineAppConfig({
  subPackages: [
    {
      root: 'pages/features',
      pages: ['detail', 'settings'],
      // 独立分包
      independent: true
    }
  ]
})

// 移除未使用的依赖
// 启用 Tree Shaking
```

### 运行时问题

#### 1. 状态更新不及时

**问题**: Redux 状态更新后组件未重新渲染

**解决方案**:
```typescript
// 检查选择器是否正确
const todos = useAppSelector(state => state.todos) // ✅
const todos = useAppSelector(state => state.todo)  // ❌ 拼写错误

// 确保使用不可变更新
// 使用 Redux Toolkit 自动处理
```

#### 2. 小程序授权问题

**问题**: 获取用户信息时授权失败

**解决方案**:
```typescript
const getUserProfile = async () => {
  try {
    // 先检查授权状态
    const authSetting = await Taro.getSetting()
    
    if (!authSetting.authSetting['scope.userInfo']) {
      // 引导用户授权
      await Taro.authorize({ scope: 'scope.userInfo' })
    }
    
    const userInfo = await Taro.getUserInfo()
    return userInfo
  } catch (error) {
    console.error('授权失败:', error)
    // 显示授权引导
  }
}
```

### 样式问题

#### 1. 跨平台样式差异

**问题**: 同一组件在不同平台显示效果不一致

**解决方案**:
```scss
// 使用平台特定样式
.button {
  padding: 16px;
  
  // 小程序特定样式
  @media (prefers-color-scheme: miniprogram) {
    padding: 32rpx;
  }
}

// 或使用条件编译
/* #ifdef H5 */
.h5-only {
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
/* #endif */
```

## 📞 技术支持

- **Taro 官方文档**: https://taro-docs.jd.com/
- **Taroify 组件库**: https://taroify.gitee.io/taroify.com/
- **TailwindCSS 文档**: https://tailwindcss.com/
- **weapp-tailwindcss**: https://tw.icebreaker.top/

---

此文档涵盖了项目的完整技术栈、开发流程和最佳实践。如有问题，请参考相关官方文档或提交 Issue。

